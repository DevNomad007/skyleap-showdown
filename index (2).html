<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SkyLeap Showdown - Responsive Mobile Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <style>
    html, body { margin:0; padding:0; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; background:linear-gradient(135deg,#1e3c72,#2a5298); color:#fff; overflow:hidden; user-select:none;}
    body { min-height:100vh; }
    canvas { display:block; background:linear-gradient(to top,#87ceeb 0%,#fff 100%); border-radius:15px; margin:20px auto 10px auto; box-shadow:0 8px 20px rgba(0,0,0,0.6); touch-action: none;}
    #overlay, #leaderboard { position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(17,39,68,0.85); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:20;}
    #leaderboard { display:none;}
    .panel { background:#123456CC; padding:40px 50px; border-radius:15px; box-shadow:0 8px 16px rgba(20,50,80,0.7); max-width:480px; width:94vw; text-align:center; color:#e0e7ff; backdrop-filter:blur(5px);}
    .panel h2, .panel h3 { margin-bottom:13px; font-weight:700;}
    .panel p { font-size:1rem; margin-bottom:9px;}
    .panel input { width:98%; padding:13px; border:none; border-radius:8px; font-size:1.08rem; margin-top:13px; box-sizing:border-box; outline:none;}
    .panel input:focus { box-shadow:0 0 8px #2196f3;}
    .panel button { width:100%; margin-top:22px; padding:13px 0; border:none; border-radius:10px; background-color:#42a5f5; font-size:1.15rem; font-weight:600; color:#fff; cursor:pointer; box-shadow:0 6px 12px rgba(66,165,245,0.7); transition:background-color 0.23s;}
    .panel button:hover { background-color:#1e88e5;}
    .panel table { width:100%; border-collapse:collapse; margin-top:10px;}
    .panel th, .panel td { text-align:left; padding:8px 10px; border-bottom:1px solid rgba(255,255,255,0.16); font-size:1em;}
    .panel th { font-weight:700;}
    #hud { position:fixed; top:11px; left:50%; transform:translateX(-50%); width:94vw; max-width:530px; text-align:center; z-index:15; color:#ffffffcc; font-weight:700; font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; text-shadow:0 0 4px #333; user-select:none; font-size:1.15rem; letter-spacing:0.01em;}
    #hud span { margin:0 15px;}
    @media (max-width:550px) {
      .panel {padding:20px 5vw;}
      #hud{font-size:1rem;}
      canvas {margin: 9px auto 4px auto;}
    }
    /* Touch controls */
    #touch-controls {
      display: none; position: fixed; bottom: 0; left: 0; width: 100vw; z-index: 15; justify-content: center; text-align:center;
      user-select: none; pointer-events: none;
    }
    #touch-controls .tc-btn {
      width: 70px; height: 70px; border-radius: 50%; border: none; margin: 10px 16px 20px 16px; font-size:2rem; background: #3071eaee; color: #fff; font-weight:bold; box-shadow:0 3px 10px #0003; pointer-events: auto; display: inline-flex; align-items:center; justify-content:center; touch-action: none;
      transition:background 0.15s;
    }
    #touch-controls .tc-btn:active { background: #194a98ee;}
    #touch-controls .tc-btn:focus { outline: 3px solid #ffcf54;}
    /* Hide HUD text on very narrow screens */
    @media (max-width:410px) {
      #hud span {margin:0 4px;font-size:0.93em;}
      #touch-controls .tc-btn {width:54px;height:54px;font-size:1.4rem;}
    }
  </style>
</head>
<body>
  <div id="hud">
    <span id="levelDisplay">Level: 1 - SkyRise</span>
    <span id="scoreDisplay">Score: 0</span>
    <span id="playerNameDisplay">Player: Character 1</span>
  </div>
  <canvas id="game" tabindex="0"></canvas>
  <div id="touch-controls">
    <button id="btnLeft"   class="tc-btn" aria-label="left">&#8592;</button>
    <button id="btnJump"   class="tc-btn" aria-label="jump">&#8679;</button>
    <button id="btnRight"  class="tc-btn" aria-label="right">&#8594;</button>
  </div>
  <div id="overlay">
    <div class="panel" id="startPanel">
      <h2>SkyLeap Showdown</h2>
      <p><strong>Objective:</strong> Reach the flag at the top while dodging UFOs and their bullets! Use shield powerups for 3 seconds to survive.<br>Controls: <b>Arrow keys</b> or <b>A/D</b> to move, <b>Space</b> to jump.<br>Or touch the onscreen buttons on mobile.</p>
      <input id="username" type="text" placeholder="Enter your username" maxlength="12" />
      <button id="startBtn">Start Game</button>
    </div>
  </div>
  <div id="leaderboard">
    <div class="panel" id="lbPanel">
      <h3>Leaderboard</h3>
      <table id="lbTable">
        <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Level</th></tr></thead>
        <tbody></tbody>
      </table>
      <button id="playAgainBtn">Play Again</button>
    </div>
  </div>
<script>
const config = {
  GAME_W: 520, GAME_H: 600, // Base game logic dimensions
  GRAVITY: 0.39, JUMP_FORCE: -9, MOVE_SPEED: 2.8, PLATFORM_HEIGHT: 13,
  LEVELS: 5,
  backgrounds: ["#a6dcef","#b4e9c4","#adcfd8","#b3a0f7","#fff7a9"],
  levelNames: ["SkyRise","Cloud Gardens","Neon Towers","Storm Skies","Sky Palace"],
  ufoColors: ["#62b1ff","#70ffb1","#ff7999","#ffe347","#d7bfff"],
};
// Responsive scaling
let scale=1, offsetX=0, offsetY=0;
let canvas = document.getElementById('game'), ctx = canvas.getContext('2d');
function setCanvasSize() {
  let w=window.innerWidth, h=window.innerHeight-38;
  let maxW=Math.min(550, w-4), maxH=Math.min(700, h-2);
  let ratioW = maxW/config.GAME_W, ratioH = maxH/config.GAME_H;
  scale = Math.min(ratioW,ratioH,1);
  canvas.width = Math.floor(config.GAME_W*scale);
  canvas.height = Math.floor(config.GAME_H*scale);
  offsetX=0; offsetY=0;
}
setCanvasSize(); window.addEventListener('resize', setCanvasSize);

let playerSize = { w: 22.8, h: 50.4 };
let player, platforms, enemies, projectiles, flag, level=1, score=0, maxLevel=1, playing=false, username="Character 1", leaderboard=[], particles = [];
let powerup = null, shieldActive = false, shieldTimer = 0;

const overlay = document.getElementById('overlay'), leaderboardDiv = document.getElementById('leaderboard');
const lbTableBody = document.querySelector('#lbTable tbody');
const usernameInput = document.getElementById('username'), lvlDisplay = document.getElementById('levelDisplay'), scoreDisplay = document.getElementById('scoreDisplay'), playerNameDisplay = document.getElementById('playerNameDisplay');
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq, duration = 100, volume = 0.17) {
  const oscillator = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  oscillator.connect(gainNode);
  gainNode.connect(audioCtx.destination);
  oscillator.type = 'triangle';
  oscillator.frequency.value = freq;
  gainNode.gain.value = volume;
  oscillator.start();
  oscillator.stop(audioCtx.currentTime + duration / 1000);
}
function jumpSound() { playTone(700, 55, 0.22);}
function hitSound() { playTone(100, 210, 0.22);}
function levelUpSound() { playTone(440, 90, 0.24); setTimeout(()=>playTone(760,80,0.2),120); setTimeout(()=>playTone(1120,85,0.22),240);}
function ufoFireSound() { const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='square'; o.frequency.setValueAtTime(240+Math.random()*140,audioCtx.currentTime); o.frequency.linearRampToValueAtTime(130+Math.random()*90,audioCtx.currentTime+0.1); g.gain.setValueAtTime(0.12+Math.random()*0.08,audioCtx.currentTime); o.connect(g);g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.10+Math.random()*0.07);}
function shieldOnSound(){playTone(920,80,0.25);setTimeout(()=>playTone(1120,90,0.20),90);}
function shieldOffSound(){playTone(340,60,0.30);}
class Particle {
  constructor(x, y, color) { this.x=x;this.y=y;this.radius=Math.random()*2+1;this.color=color;this.vx=Math.random()*1.7-0.8;this.vy=Math.random()*-2.1-1;this.life=28+Math.random()*10;}
  update(){this.x+=this.vx;this.y+=this.vy;this.vy+=0.11;this.life--;}
  draw(ctx){ctx.save();ctx.beginPath();ctx.globalAlpha=Math.max(0,this.life/28);ctx.fillStyle=this.color;ctx.arc(this.x,this.y,this.radius,0,2*Math.PI);ctx.fill();ctx.restore();}
  isDead(){return this.life<=0;}
}
function emitParticles(x, y, color, count = 7) { for (let i = 0; i < count; i++) particles.push(new Particle(x, y, color)); }
function updateParticles(){for(let i=particles.length-1;i>=0;i--){particles[i].update();if(particles[i].isDead())particles.splice(i,1);}}
function drawParticles(){particles.forEach(p=>p.draw(ctx));}

function makePlatformsAndFlag() {
  let arr = [];
  let startY = config.GAME_H - 70;
  arr.push({ x: config.GAME_W / 2 - 75, y: startY, w: 150, speed: 0, moving: false, vanish: false, visible: true, playerVisited: false });
  let numPlatforms = 5, minX = 24, maxX = config.GAME_W-120, vGap=(startY-80)/(numPlatforms+1), prevX=arr[0].x+75, maxHoriz=180;
  for (let i = 0; i < numPlatforms; i++) {
    let y = startY - (i+1)*vGap, x = prevX + (Math.random()<0.5?-1:1)*(0.6+Math.random()*0.4)*maxHoriz;
    x = Math.max(minX, Math.min(maxX, x));
    arr.push({x, y, w: 110+Math.random()*45, speed:0, moving: false, vanish:false, visible:true, playerVisited:false});
    prevX = x + Math.random()*30-15;
  }
  let flagPlat = { x: config.GAME_W/2 - 32, y: 23, w: 64, speed: 0, moving: false, vanish: false, visible: true, playerVisited: false };
  arr.push(flagPlat);
  flag = { x: flagPlat.x + flagPlat.w/2 - 7, y: flagPlat.y - 35, w: 14, h: 32, collected: false };
  let midPlat = arr[1 + Math.floor(numPlatforms/2)];
  powerup = { x: midPlat.x + midPlat.w/2 - 10, y: midPlat.y - 23, w: 20, h: 20, taken: false, t:0 };
  return arr;
}
function makeEnemies() {
  let arr = [], count = 1 + level;
  for (let i = 0; i < count; i++) {
    arr.push({ x: 90 + Math.random() * (config.GAME_W - 180), y: 55 + Math.random() * (config.GAME_H - 260),
      dir: Math.random() < 0.5 ? -1 : 1, fireCD: 40 + Math.random()*60 + Math.random()*60,
      color: config.ufoColors[level-1], t:0 });
  }
  return arr;
}
function spawnBullets(ufo) {
  let angleToPlayer = Math.atan2((player.y + player.h/2) - ufo.y, (player.x+player.w/2) - ufo.x);
  let spreadAngles = [ angleToPlayer + Math.PI/4, angleToPlayer - Math.PI/4 ];
  for (let a of spreadAngles) {
    let spd = 2.7 + Math.random()*0.3;
    projectiles.push({ x: ufo.x, y: ufo.y + 14, vx: Math.cos(a)*spd, vy: Math.sin(a)*spd, r: 5.3, color:'#33c6ff', t:0 });
    ufoFireSound();
  }
}
function nextUfoFireCD(level){return 20+Math.random()*50+Math.random()*38-level*1.7;}
function resetGame(){
  platforms = makePlatformsAndFlag(); enemies = makeEnemies(); projectiles = []; particles = [];
  let firstPlat = platforms[0];
  player = { x: firstPlat.x+firstPlat.w/2-playerSize.w/2, y: firstPlat.y-playerSize.h, vx:0, vy:0, jumping:false, alive:true, flashTime:0, w:playerSize.w, h:playerSize.h};
  flag.collected = false; shieldActive = false; shieldTimer = 0; powerup.taken=false; level=1; score=0; maxLevel=1;
  updateHud(); playing=true;
}
function nextLevel(){
  level++; if(level>config.LEVELS){endGame();return;}
  maxLevel=Math.max(maxLevel,level); platforms=makePlatformsAndFlag(); enemies=makeEnemies(); projectiles=[];
  let firstPlat = platforms[0];
  player.x = firstPlat.x+firstPlat.w/2-playerSize.w/2; player.y = firstPlat.y-playerSize.h; player.vx=0; player.vy=0; player.jumping=false; player.alive=true;
  flag.collected=false; shieldActive=false; shieldTimer=0; powerup.taken=false;
  updateHud(); levelUpSound();
}
function endGame(){playing=false; addToLeaderboard({name:username,score,level:maxLevel}); setTimeout(showLeaderboard,800); hitSound();}
const KEYS = {};
function setKey(k,val){KEYS[k]=val;}
window.addEventListener('keydown',e=>{KEYS[e.key.toLowerCase()]=true; if(e.key==' '||e.key=='spacebar')e.preventDefault();});
window.addEventListener('keyup',e=>{KEYS[e.key.toLowerCase()]=false;});
// Touch controls for mobile
const tc = document.getElementById("touch-controls");
const btnL = document.getElementById("btnLeft"), btnR = document.getElementById("btnRight"), btnJ = document.getElementById("btnJump");
function maybeShowTouch() {
  if(window.innerWidth < 700 || window.matchMedia('(pointer:coarse)').matches) tc.style.display='flex';
  else tc.style.display='none';
}
maybeShowTouch();
window.addEventListener("resize", maybeShowTouch);

// Touch logic
let tInterval=null, tMoveL=false, tMoveR=false;
function tClear() {clearInterval(tInterval);tInterval=null;}
function tMoveLeft(e){e.preventDefault();tMoveL=true;KEYS['arrowleft']=true;}
function tMoveRight(e){e.preventDefault();tMoveR=true;KEYS['arrowright']=true;}
function tStopLeft(e){e.preventDefault();tMoveL=false;KEYS['arrowleft']=false;}
function tStopRight(e){e.preventDefault();tMoveR=false;KEYS['arrowright']=false;}
function tJump(e){e.preventDefault();KEYS[' ']=true;setTimeout(()=>{KEYS[' ']=false;},160);}
btnL.addEventListener("touchstart",tMoveLeft);
btnL.addEventListener("touchend",tStopLeft);
btnL.addEventListener("touchcancel",tStopLeft);
btnR.addEventListener("touchstart",tMoveRight);
btnR.addEventListener("touchend",tStopRight);
btnR.addEventListener("touchcancel",tStopRight);
btnJ.addEventListener("touchstart",tJump);

function updateHud(){lvlDisplay.textContent=`Level: ${level} - ${config.levelNames[level-1]}`; scoreDisplay.textContent=`Score: ${score}`; playerNameDisplay.textContent=`Player: ${username}`;}
function saveLeaderboard(){localStorage.setItem("skyleap_lb",JSON.stringify(leaderboard.slice(0,5)));}
function loadLeaderboard(){leaderboard=JSON.parse(localStorage.getItem("skyleap_lb")||"[]");}
function addToLeaderboard(entry){leaderboard.push(entry);leaderboard.sort((a,b)=>b.score-a.score||b.level-a.level);leaderboard=leaderboard.slice(0,5);saveLeaderboard();}
function showLeaderboard(){lbTableBody.innerHTML="";leaderboard.forEach((item,i)=>{lbTableBody.innerHTML+=`<tr><td>${i+1}</td><td>${item.name}</td><td>${item.score}</td><td>${item.level}</td></tr>`;});leaderboardDiv.style.display="flex";overlay.style.display="none";}
function gameLoop() {
  if(!playing) return;
  // KEYBOARD + TOUCH
  if(KEYS['arrowleft']||KEYS['a']) player.vx = -config.MOVE_SPEED;
  else if(KEYS['arrowright']||KEYS['d']) player.vx = config.MOVE_SPEED;
  else player.vx = 0;
  if((KEYS[' ']||KEYS['spacebar'])&&!player.jumping) {player.vy=config.JUMP_FORCE;player.jumping=true;jumpSound();emitParticles(player.x+player.w/2,player.y+player.h,'#ffba08',7);}
  player.x=Math.max(0,Math.min(config.GAME_W-player.w,player.x+player.vx));
  player.vy+=config.GRAVITY;player.y+=player.vy;
  let onPlatform=false;
  platforms.forEach(p=>{
    if(p.visible&&player.y+player.h<p.y+config.PLATFORM_HEIGHT&&player.y+player.h>p.y&&player.x+player.w-6>p.x&&player.x+6<p.x+p.w&&player.vy>=0) {
      player.y=p.y-player.h; player.vy=0; if(player.jumping)player.jumping=false; onPlatform=true; if(p.vanish&&p.visible)p.visible=false; if(!p.playerVisited){score++;p.playerVisited=true;updateHud();}
    }
    if(p.moving){p.x+=p.speed;if(p.x<24)p.x=24;if(p.x>config.GAME_W-p.w-24)p.x=config.GAME_W-p.w-24;}
  });
  if(!onPlatform && player.y+player.h>=config.GAME_H){endGame();return;}
  if(!powerup.taken && player.x+player.w>powerup.x && player.x<powerup.x+powerup.w && player.y+player.h>powerup.y && player.y<powerup.y+powerup.h){powerup.taken=true;shieldActive=true;shieldTimer=180;shieldOnSound();}
  if(shieldActive){shieldTimer--;if(shieldTimer<=0){shieldActive=false;shieldOffSound();}}
  enemies.forEach(ufo => {ufo.x+=ufo.dir*(0.92+level*0.11);if(ufo.x<=40||ufo.x>=config.GAME_W-40)ufo.dir=-ufo.dir;ufo.t++;if(ufo.t>ufo.fireCD){spawnBullets(ufo);ufo.t=0;ufo.fireCD=nextUfoFireCD(level);}});
  projectiles.forEach(pr => {pr.x+=pr.vx;pr.y+=pr.vy;pr.t++;});
  projectiles=projectiles.filter(pr=>pr.y>-24&&pr.x>-24&&pr.x<config.GAME_W+24&&pr.t<295);
  for(let pr of projectiles) {
    let dx=(player.x+player.w/2)-pr.x, dy=(player.y+player.h/2)-pr.y, dist=Math.sqrt(dx*dx+dy*dy);
    if(dist<player.w/2*0.84+pr.r) {
      if(!shieldActive){if(player.alive){player.alive=false;player.flashTime=20;hitSound();emitParticles(player.x+player.w/2,player.y+player.h/2,'#78cafa',10);}playing=false;setTimeout(endGame,260);break;}
      else{emitParticles(player.x+player.w/2,player.y+player.h/2,"#65d5ff",4);pr.t=300;}
    }
  }
  if(!flag.collected && player.x+player.w>flag.x && player.x<flag.x+flag.w && player.y+player.h>flag.y && player.y<flag.y+flag.h){
    flag.collected=true; score+=5*level; updateHud(); levelUpSound(); nextLevel(); render(); requestAnimationFrame(gameLoop); return;
  }
  render(); requestAnimationFrame(gameLoop);
}
function render(){
  ctx.setTransform(scale,0,0,scale,0,0);
  ctx.clearRect(0,0,config.GAME_W,config.GAME_H);
  let grad=ctx.createLinearGradient(0,config.GAME_H,0,0);grad.addColorStop(0,config.backgrounds[level-1]);grad.addColorStop(1,'#fff');
  ctx.fillStyle=grad;ctx.fillRect(0,0,config.GAME_W,config.GAME_H);
  platforms.forEach((p,idx) => { if (!p.visible) return; ctx.save(); ctx.fillStyle='#325687'; ctx.shadowColor='#0006'; ctx.shadowBlur=7; ctx.beginPath(); if (typeof ctx.roundRect === "function") ctx.roundRect(p.x,p.y,p.w,config.PLATFORM_HEIGHT,7); else ctx.rect(p.x,p.y,p.w,config.PLATFORM_HEIGHT); ctx.fill(); ctx.shadowBlur=0; ctx.restore();});
  drawStickFigurePlayer(ctx);
  enemies.forEach(ufo => drawUFO(ctx,ufo.x,ufo.y,config.ufoColors[level-1]));
  projectiles.forEach(pr => {ctx.save();ctx.beginPath();ctx.arc(pr.x,pr.y,pr.r,0,2*Math.PI);ctx.fillStyle=pr.color;ctx.shadowBlur=6;ctx.shadowColor='#00e1ff';ctx.fill();ctx.lineWidth=2;ctx.strokeStyle="#2196f3";ctx.stroke();ctx.restore();});
  drawFlag(ctx,flag.x,flag.y,flag.collected);
  if(!powerup.taken)drawShieldPowerup(ctx,powerup.x,powerup.y,powerup.t++);
  drawParticles();updateParticles();
}
function drawStickFigurePlayer(ctx){
  let px=player.x,py=player.y; ctx.save();
  ctx.translate(px+player.w/2,py+player.h-0.6*player.h);
  let scale2=player.w/18;ctx.scale(scale2,scale2);
  let bounce=(player.jumping&&player.alive)?Math.sin(Date.now()/80)*2:0; ctx.translate(0,bounce);
  if(shieldActive){let pulse=1+0.10*Math.sin(Date.now()/120);ctx.save();ctx.globalAlpha=0.44+0.1*Math.sin(Date.now()/130);ctx.beginPath();ctx.arc(0,10,17*pulse,0,2*Math.PI);ctx.fillStyle="rgba(145,238,255,0.13)";ctx.fill();ctx.lineWidth=4.7+1.8*Math.sin(Date.now()/210);ctx.strokeStyle="rgba(52,202,246,0.7)";ctx.shadowColor="#89f0fc";ctx.shadowBlur=14+6*Math.sin(Date.now()/180);ctx.stroke();ctx.restore();}
  ctx.save();ctx.globalAlpha=0.23;ctx.beginPath();ctx.ellipse(0,44,12,3,0,0,2*Math.PI);ctx.fillStyle="#31381f";ctx.fill();ctx.restore();
  ctx.save();ctx.lineCap="round";ctx.lineWidth=4;ctx.strokeStyle="#70afff";ctx.beginPath();ctx.moveTo(0,13);ctx.lineTo(-11,20);ctx.moveTo(0,13);ctx.lineTo(10,16);ctx.stroke();ctx.lineWidth=6;ctx.strokeStyle="#ffe363";ctx.beginPath();ctx.arc(-11,20,2.1,0,2*Math.PI);ctx.arc(10,16,2.1,0,2*Math.PI);ctx.stroke();ctx.restore();
  ctx.save();ctx.lineCap="round";ctx.lineWidth=6;ctx.strokeStyle="#236db7";ctx.beginPath();ctx.moveTo(0,11);ctx.lineTo(0,22);ctx.stroke();ctx.restore();
  ctx.save();ctx.lineWidth=4.3;ctx.strokeStyle="#313774";ctx.beginPath();ctx.moveTo(0,22);ctx.lineTo(6,32);ctx.stroke();ctx.beginPath();ctx.moveTo(0,22);ctx.lineTo(-6,31);ctx.stroke();ctx.lineWidth=6;ctx.strokeStyle="#9fe3f9";ctx.beginPath();ctx.arc(-6,31,1.6,0,2*Math.PI);ctx.arc(6,32,1.8,0,2*Math.PI);ctx.stroke();ctx.restore();
  ctx.save();ctx.lineWidth=6;ctx.strokeStyle="#ff702a";ctx.beginPath();ctx.arc(-7,35,2,0,Math.PI*2);ctx.arc(8,35.5,2,0,Math.PI*2);ctx.stroke();ctx.restore();
  ctx.save();let grad=ctx.createRadialGradient(0,-2,2,0,0,9);grad.addColorStop(0,"#fff7de");grad.addColorStop(0.95,"#fdedaa");ctx.beginPath();ctx.arc(0,0,7.8,0,2*Math.PI);ctx.fillStyle=grad;ctx.shadowColor="#ffe680";ctx.shadowBlur=7;ctx.fill();ctx.lineWidth=1.3;ctx.strokeStyle="#deb27c";ctx.stroke();ctx.restore();
  ctx.save();ctx.beginPath();ctx.ellipse(0,-6,6,2.8,0,Math.PI,2*Math.PI);ctx.fillStyle="#4286f4";ctx.fill();ctx.beginPath();ctx.ellipse(0,-4.2,5.7,1.3,0,0,Math.PI);ctx.fillStyle="#2750aa";ctx.globalAlpha=0.85;ctx.fill();ctx.restore();
  ctx.save();ctx.fillStyle="#121a1a";let leftEyeY=player.alive?-2.2:0;let rightEyeY=player.jumping&&player.alive&&Math.floor(Date.now()/110)%7===0?-1.4:-2.2;
  if(!player.alive&&Math.floor(Date.now()/240)%2===0){ctx.lineWidth=1;ctx.beginPath();ctx.moveTo(-2.4,-2);ctx.lineTo(-1,-2.2);ctx.moveTo(1.8,-2);ctx.lineTo(2.9,-2.2);ctx.strokeStyle="#715403";ctx.stroke();}
  else{ctx.beginPath();ctx.arc(-2,leftEyeY,.85,0,2*Math.PI);ctx.arc(2,rightEyeY,.95,0,2*Math.PI);ctx.fill();}
  ctx.restore();ctx.save();ctx.strokeStyle="#6e4620";ctx.lineWidth=0.85;ctx.beginPath();if(!player.alive)ctx.arc(0,5,2,Math.PI,0,false);else if(player.jumping)ctx.arc(0,2,1.48,0,2*Math.PI);else ctx.arc(0,1.8,2.2,0,Math.PI,false);ctx.stroke();ctx.restore();
  if(player.jumping&&player.alive){ctx.save();ctx.fillStyle="#f8c07b";ctx.beginPath();ctx.arc(-12,7,1.8,0,2*Math.PI);ctx.arc(9,6,1.8,0,2*Math.PI);ctx.shadowBlur=3;ctx.shadowColor="#ffe99e";ctx.globalAlpha=0.9;ctx.fill();ctx.restore();}
  ctx.restore();
}
function drawUFO(ctx, x, y, color){ctx.save();ctx.beginPath();ctx.ellipse(x,y,15,10,0,Math.PI,2*Math.PI);ctx.fillStyle="#fff";ctx.globalAlpha=0.96;ctx.shadowBlur=10;ctx.shadowColor=color;ctx.fill();ctx.beginPath();ctx.ellipse(x,y+8,22,9,0,0,Math.PI,true);ctx.globalAlpha=1.0;ctx.fillStyle=color;ctx.shadowBlur=7;ctx.shadowColor=color;ctx.fill();for(let i=-2;i<=2;i++){ctx.beginPath();ctx.arc(x+i*7,y+11,2.3,0,2*Math.PI);ctx.fillStyle="#ffe57f";ctx.globalAlpha=0.97;ctx.fill();}ctx.restore();}
function drawFlag(ctx,x,y,collected){
  ctx.save();ctx.beginPath();ctx.lineWidth=2.1;ctx.strokeStyle="#555";ctx.moveTo(x+2,y+27);ctx.lineTo(x+2,y+8);ctx.stroke();
  ctx.beginPath();ctx.moveTo(x+3,y+8);ctx.lineTo(x+13,y+14);ctx.lineTo(x+3,y+20);ctx.closePath();ctx.fillStyle=collected?"#73ff7c":"#f73";ctx.shadowColor="#fff";ctx.shadowBlur=4;ctx.fill();
  ctx.beginPath();ctx.arc(x+2,y+7,1.4,0,2*Math.PI);ctx.fillStyle="#ffe600";ctx.shadowBlur=0;ctx.fill();ctx.restore();
}
function drawShieldPowerup(ctx,x,y,t){
  ctx.save();ctx.globalAlpha=0.5+0.28*Math.sin(t/17);ctx.beginPath();ctx.arc(x+10,y+10,13+Math.sin(t/12)*2,0,2*Math.PI);ctx.fillStyle="#51dafd";ctx.shadowColor="#b7fff6";ctx.shadowBlur=9;ctx.fill();ctx.beginPath();ctx.arc(x+10,y+10,8,0,2*Math.PI);ctx.globalAlpha=0.68+0.24*Math.sin(t/7);ctx.fillStyle="#ffe058";ctx.fill();ctx.restore();ctx.save();ctx.globalAlpha=1;ctx.beginPath();ctx.arc(x+10,y+10,6,0,2*Math.PI);ctx.fillStyle="#7affab";ctx.shadowBlur=0;ctx.fill();ctx.restore();
}
document.getElementById('startBtn').onclick = () => {
  const nameVal = usernameInput.value.trim();
  if (nameVal) { username = nameVal.slice(0, 12); }
  playerNameDisplay.textContent = `Player: ${username}`;
  overlay.style.display = 'none'; leaderboardDiv.style.display = 'none';
  resetGame(); gameLoop(); canvas.focus();
};
document.getElementById('playAgainBtn').onclick = () => {
  overlay.style.display = 'flex'; leaderboardDiv.style.display = 'none'; usernameInput.value = username; usernameInput.style.borderColor = ''; usernameInput.focus();
};
function firstInit(){ loadLeaderboard(); showLeaderboard(); canvas.onclick = () => canvas.focus(); document.body.onclick = () => { if(audioCtx.state==="suspended") audioCtx.resume();}; }
firstInit();
</script>
</body>
</html>
